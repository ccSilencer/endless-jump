<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Endless Jump</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100vh;
      background: radial-gradient(#0f0f0f, #000000);
      font-family: 'Press Start 2P', monospace;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      color: #00ffcc;
    }
    #wrapper {
      background: #1c1c1c;
      padding: 8px;
      display: flex;
      justify-content: center;
      align-items: center;
      border: 4px solid #000;
      box-sizing: border-box;
    }
    canvas {
      image-rendering: pixelated;
      max-width: 100vw;
      max-height: 100vh;
      width: 100%;
      height: auto;
    }
    #menu, #options, #controls, #gameover {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(10, 10, 10, 0.95);
      padding: 60px 30px 30px 30px;
      border: 4px double #00ffcc;
      color: #00ffcc;
      font-family: 'Press Start 2P', monospace;
      text-align: center;
      display: none;
      z-index: 10;
      box-shadow: 0 0 35px #00ffee;
      animation: fadeIn 0.5s ease-in-out;
    }
    #gameover {
      border: 4px double #ff0033;
      color: #ff0033;
      box-shadow: 0 0 35px #ff0033;
      padding-top: 40px;
    }
    #menu h1, #gameover h1 {
      font-size: 22px;
      margin: 0 0 20px 0;
      color: #fff;
      text-shadow: 0 0 5px #00ffee, 0 0 10px #00ffee;
    }
    button {
      margin: 10px;
      padding: 14px 28px;
      font-size: 14px;
      font-family: 'Press Start 2P', monospace;
      background: #000;
      border: 2px solid #00ffcc;
      color: #00ffcc;
      cursor: pointer;
      transition: all 0.2s ease;
      text-shadow: 0 0 3px #00ffee;
    }
    button:hover {
      background: #00ffee;
      color: #000;
      text-shadow: none;
    }
    #gameover button {
      border: 2px solid #ff0033;
      color: #ff0033;
      text-shadow: 0 0 3px #ff0033;
    }
    #gameover button:hover {
      background: #ff0033;
      color: #000;
    }
    #score {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-family: 'Press Start 2P', monospace;
      font-size: 16px;
      text-shadow: 1px 1px #000;
    }
    #spruch {
      position: absolute;
      right: 20px;
      bottom: 20px;
      transform: rotate(-6deg);
      color: #fff;
      font-size: 14px;
      font-family: 'Press Start 2P', monospace;
      max-width: 220px;
      text-align: right;
      z-index: 9;
      display: none;
      pointer-events: none;
      text-shadow: 0 0 4px #ff0033;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, -60%); }
      to   { opacity: 1; transform: translate(-50%, -50%); }
    }
  </style>
</head>
<body>
  <div id="menu">
    <h1>üßü ENDLESS JUMP</h1>
    <button onclick="prepareGame()">‚ñ∂ SPIEL STARTEN</button><br>
    <button onclick="showControls()">üïπÔ∏è STEUERUNG</button><br>
    <button onclick="showOptions()">‚öôÔ∏è OPTIONEN</button>
  </div>
  <div id="controls"><h2>üïπÔ∏è STEUERUNG</h2><p>SPACE / TAP</p><button onclick="backToMenu()">üîô ZUR√úCK</button></div>
  <div id="options">
    <h2>‚öôÔ∏è OPTIONEN</h2>
    <label id="volumeLabel">Lautst√§rke: <input type="range" min="0" max="1" step="0.01" value="0.5" id="volumeSlider"></label><br><br>
    <button onclick="resetHighscore()">‚õî HIGHSCORE L√ñSCHEN</button><br><br>
    <button onclick="backToMenu()">üîô ZUR√úCK</button>
  </div>
  <div id="gameover">
    <h1>üíÄ GAME OVER</h1>
    <p id="scoreDisplay" style="margin-top: 60px;"></p>
    <button onclick="prepareGame()">üîÅ NOCHMAL</button>
    <button onclick="showOptions()">‚öôÔ∏è OPTIONEN</button>
    <button onclick="backToMenu()">üö™ AUFGEBEN</button>
  </div>
  <div id="score">Score: 0</div>
  <div id="spruch"></div>
  <div id="wrapper"><canvas id="game" width="1024" height="576"></canvas></div>
  <audio id="bgmusic" src="bgmusic.mp3" loop></audio>
  <audio id="darkmusic" src="darktheme.mp3" loop></audio>
  <audio id="gameovermusic" src="gameover.mp3" loop></audio>
  <script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const player = { x: 100, y: 0, width: 32, height: 32, velY: 0, onGround: false };
const gravity = 0.6, jumpForce = -16;
let scrollX = 0, speed = 3, speedTimer = 0, score = 0;
let platforms = [], platformSpacing = 200, gameReady = false, isGameRunning = false;
let darkMusicStarted = false;
let highscore = parseInt(localStorage.getItem("highscore") || "0");
let wasInGameOverScreen = false;

const music = document.getElementById("bgmusic");
const darkMusic = document.getElementById("darkmusic");
const gameoverMusic = document.getElementById("gameovermusic");
const sayings = [
  "üåà Beim n√§chsten Mal klappt‚Äôs bestimmt!",
  "üí™ Aufstehen, Krone richten, weiterh√ºpfen!",
  "üéÆ Das war nur der Probelauf.",
  "üåü Du bist der Held unserer Herzen!",
  "‚òï Eine Pause und dann: Comeback!"
];

const menu = document.getElementById("menu");
const options = document.getElementById("options");
const controls = document.getElementById("controls");
const gameover = document.getElementById("gameover");
const scoreDiv = document.getElementById("score");
const spruchBox = document.getElementById("spruch");
const scoreDisplay = document.getElementById("scoreDisplay");

document.getElementById("volumeSlider").addEventListener("input", e => {
  [music, darkMusic, gameoverMusic].forEach(a => a.volume = e.target.value);
});

function resetHighscore() {
  highscore = 0;
  localStorage.setItem("highscore", "0");
}

function easeInOutQuad(x) {
  return x < 0.5 ? 2 * x * x : 1 - Math.pow(-2 * x + 2, 2) / 2;
}

function showMenu() {
  [menu, scoreDiv].forEach(el => el.style.display = "block");
  [options, controls, gameover, spruchBox].forEach(el => el.style.display = "none");
  isGameRunning = false;
}

function backToMenu() {
  [options, controls, gameover, spruchBox].forEach(el => el.style.display = "none");
  menu.style.display = "block";
}

function showOptions() {
  [menu, controls, gameover].forEach(el => el.style.display = "none");
  options.style.display = "block";
}

function showControls() {
  [menu, options, gameover].forEach(el => el.style.display = "none");
  controls.style.display = "block";
}

function createPlatform(x, baseY) {
  const maxHeightChange = 130;
  const lastY = platforms.length ? platforms[platforms.length - 1].y : baseY;
  const dy = Math.floor(Math.random() * maxHeightChange * 2) - maxHeightChange;
  let y = lastY + dy;
  const minY = 270;
  const maxY = canvas.height - 80;
  y = Math.max(minY, Math.min(maxY, y));
  const width = Math.floor(Math.random() * 40) + 90;
  platforms.push({ x, y, width, height: 16 });
}

function prepareGame() {
  [gameoverMusic, darkMusic, music].forEach(a => { a.pause(); a.currentTime = 0; });
  darkMusicStarted = false;
  wasInGameOverScreen = false;
  [menu, options, controls, gameover, spruchBox].forEach(el => el.style.display = "none");
  scrollX = 0; speed = 3; speedTimer = 0; platforms = []; score = 0;
  const baseY = canvas.height - 80;
  const clampY = y => Math.max(270, Math.min(baseY, y));

  let x = 0, y = baseY;
  platforms.push({ x, y, width: 120, height: 16 });

  x += 160;
  y = clampY(y + (Math.random() * 60 - 30));
  platforms.push({ x, y, width: 110, height: 16 });

  x += 180;
  y = clampY(y + (Math.random() * 80 - 40));
  platforms.push({ x, y, width: 110, height: 16 });

  x += 200;
  y = clampY(y + (Math.random() * 80 - 40));
  platforms.push({ x, y, width: 100, height: 16 });

  for (let i = platforms.length; i < 15; i++) {
    x += platformSpacing;
    createPlatform(x, baseY);
  }

  const firstPlatform = platforms[0];
  player.x = firstPlatform.x + firstPlatform.width / 2 - player.width / 2;
  player.y = firstPlatform.y - player.height;

  scrollX = player.x - canvas.width * 0.3;
  player.velY = 0;
  player.onGround = true;
  gameReady = true;
  isGameRunning = false;
  scoreDiv.textContent = "Score: 0";
  draw();
  lastTime = performance.now();
  requestAnimationFrame(gameLoop);
}


function startGame(withJump = false) {
  isGameRunning = true;
  music.volume = 0.5;
  [music, darkMusic].forEach(a => { a.pause(); a.currentTime = 0; });
  music.play().catch(() => {});
  if (withJump && player.onGround) {
    player.velY = jumpForce;
    player.onGround = false;
  }
}

document.addEventListener("keydown", e => {
  if (e.code === "Space") {
    if (!isGameRunning && wasInGameOverScreen) {
      wasInGameOverScreen = false;
      prepareGame();
      return;
    }
    if (gameReady) {
      startGame(true);
      gameReady = false;
    } else if (player.onGround) {
      player.velY = jumpForce;
      player.onGround = false;
    }
  }
});

canvas.addEventListener("touchstart", () => {
  if (gameReady) {
    startGame(true);
    gameReady = false;
  } else if (player.onGround) {
    player.velY = jumpForce;
    player.onGround = false;
  }
});

let lastTime = 0;
function gameLoop(timestamp) {
  const delta = (timestamp - lastTime) / 16.6667;
  lastTime = timestamp;
  update(delta);
  draw();
  requestAnimationFrame(gameLoop);
}

function update(delta) {
  if (!isGameRunning) return;
  speedTimer += delta;
  score = Math.floor(speedTimer / 10);
  scoreDiv.textContent = "Score: " + score;

  if (score >= 300 && !darkMusicStarted) {
    darkMusicStarted = true;
    darkMusic.volume = 0;
    darkMusic.play().catch(() => {});
  }

  if (darkMusicStarted) {
    music.volume = Math.max(0, music.volume - 0.0007 * delta);
    darkMusic.volume = Math.min(0.5, darkMusic.volume + 0.0007 * delta);
  }

  if (Math.floor(speedTimer / 600) > Math.floor((speedTimer - delta) / 600) && speed < 6) {
    speed += 0.25;
    platformSpacing = Math.min(280, platformSpacing + 10);
  }

  player.velY += gravity * delta;
  player.y += player.velY * delta;
  if (player.y < 20 && player.velY < 0) player.velY *= 0.5;
  player.x += speed * delta;
  scrollX = player.x - canvas.width * 0.3;

  if (platforms[0].x + platforms[0].width < scrollX - 100) {
    const last = platforms[platforms.length - 1];
    platforms.shift();
    createPlatform(last.x + platformSpacing, last.y);
  }

  player.onGround = false;
  for (let p of platforms) {
    if (player.x < p.x + p.width && player.x + player.width > p.x &&
        player.y + player.height < p.y + 10 &&
        player.y + player.height + player.velY * delta >= p.y) {
      player.y = p.y - player.height;
      player.velY = 0;
      player.onGround = true;
    }
  }

  if (player.y > canvas.height) {
    isGameRunning = false;
    wasInGameOverScreen = true;
    if (score > highscore) {
      highscore = score;
      localStorage.setItem("highscore", highscore);
    }
    scoreDisplay.innerHTML = `Dein Score: ${score}<br><br>Highscore: ${highscore}`;
    spruchBox.textContent = sayings[Math.floor(Math.random() * sayings.length)];
    spruchBox.style.display = "block";
    gameover.style.display = "block";
    [music, darkMusic].forEach(a => { a.pause(); a.currentTime = 0; });
    gameoverMusic.play().catch(() => {});
  }
}

function draw() {
  const corruption = Math.min(1, score / 500);
  const smooth = easeInOutQuad(corruption);
  const sky = ctx.createLinearGradient(0, 0, 0, canvas.height);
  sky.addColorStop(0, `rgb(${94 + 100 * smooth}, ${194 - 100 * smooth}, ${240 - 200 * smooth})`);
  sky.addColorStop(1, `rgb(${204 - 70 * smooth}, ${238 - 200 * smooth}, ${255 - 255 * smooth})`);
  ctx.fillStyle = sky;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  for (let p of platforms) {
    let r = Math.floor(76 + 100 * smooth);
    let g = Math.floor(175 - 150 * smooth);
    let b = Math.floor(80 - 80 * smooth);
    ctx.fillStyle = `rgb(${r},${g},${b})`;
    ctx.fillRect(p.x - scrollX, p.y, p.width, 8);
    ctx.fillStyle = `rgba(${r - 50},0,0,0.6)`;
    ctx.fillRect(p.x - scrollX, p.y + 8, p.width, 8);
  }

  const px = player.x - scrollX, py = player.y;
  const bodyColor = smooth > 0.8 ? "#556b2f" : smooth > 0.4 ? "#888" : "#ff5050";
  const eyeOuter = smooth > 0.5 ? "#ff0000" : "#000";
  const eyeInner = smooth > 0.5 ? "#ffa0a0" : "#fff";
  const mouthColor = smooth > 0.7 ? "#aa0000" : "#000";
  const toothColor = smooth > 0.8 ? "#fff" : null;
  const armColor = smooth > 0.7 ? "#660000" : "#cc0000";

  ctx.fillStyle = bodyColor;
  ctx.fillRect(px, py, player.width, player.height);

  ctx.fillStyle = eyeOuter;
  ctx.fillRect(px + 6, py + 4, 6, 6);
  ctx.fillRect(px + 20, py + 4, 6, 6);

  ctx.fillStyle = eyeInner;
  ctx.fillRect(px + 8, py + 6, 2, 2);
  ctx.fillRect(px + 22, py + 6, 2, 2);

  ctx.fillStyle = mouthColor;
  ctx.fillRect(px + 10, py + 12, 12, 4);
  if (toothColor) {
    ctx.fillStyle = toothColor;
    ctx.fillRect(px + 11, py + 12, 2, 4);
    ctx.fillRect(px + 14, py + 12, 2, 4);
    ctx.fillRect(px + 17, py + 12, 2, 4);
  }

  ctx.fillStyle = armColor;
  ctx.fillRect(px - 4, py + 12, 4, 10);
  ctx.fillRect(px + player.width, py + 12, 4, 10);
  ctx.fillRect(px + 2, py + player.height - 4, 8, 4);
  ctx.fillRect(px + 22, py + player.height - 4, 8, 4);

  if (smooth > 0.8) {
    ctx.fillStyle = "#222";
    ctx.fillRect(px + 5, py + 20, 3, 3);
    ctx.fillRect(px + 18, py + 24, 4, 2);
    ctx.fillRect(px + 13, py + 6, 2, 2);
  }
}

showMenu();
</script>
</body>
</html>
