<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Endless Jump</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100dvh;
      background: radial-gradient(#202020, #050505);
      font-family: 'Inter', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      color: #1abc9c;
      -webkit-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: none;
    }
    #wrapper {
      background: #111;
      padding: 8px;
      display: flex;
      justify-content: center;
      align-items: center;
      border: 2px solid #333;
      border-radius: 12px;
      box-sizing: border-box;
      width: 100%;
      height: 100%;
    }
    canvas {
      image-rendering: pixelated;
      width: 100vw;
      height: 100dvh;
      touch-action: none;
    }
    #menu, #options, #controls, #gameover {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(20, 20, 20, 0.95);
      padding: 50px 40px 30px 40px;
      border: 2px solid #1abc9c;
      border-radius: 8px;
      color: #eee;
      font-family: 'Inter', sans-serif;
      text-align: center;
      display: none;
      z-index: 10;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      animation: fadeIn 0.4s ease-in-out;
    }
    #gameover {
      border-color: #ff4e4e;
      color: #ff4e4e;
      box-shadow: 0 0 20px rgba(255,78,78,0.5);
      padding-top: 40px;
    }
    #menu h1, #gameover h1 {
      font-size: 26px;
      margin: 0 0 20px 0;
      color: #fff;
      text-shadow: none;
    }
    button {
      margin: 10px;
      padding: 12px 28px;
      font-size: 14px;
      font-family: 'Inter', sans-serif;
      background: #111;
      border: 1px solid #1abc9c;
      border-radius: 6px;
      color: #1abc9c;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    button:hover {
      background: #1abc9c;
      color: #111;
    }
    #gameover button {
      border-color: #ff4e4e;
      color: #ff4e4e;
    }
    #gameover button:hover {
      background: #ff4e4e;
      color: #111;
    }
    #spruch {
      position: absolute;
      right: 20px;
      bottom: 20px;
      transform: rotate(-6deg);
      color: #fff;
      font-size: 14px;
      font-family: 'Inter', sans-serif;
      max-width: 220px;
      text-align: right;
      z-index: 9;
      display: none;
      pointer-events: none;
      text-shadow: 0 0 4px #ff4e4e;
    }
    #rotateMsg {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(20, 20, 20, 0.95);
      padding: 20px;
      border: 2px solid #1abc9c;
      color: #1abc9c;
      font-family: 'Inter', sans-serif;
      text-align: center;
      z-index: 20;
    }

    @media screen and (orientation: portrait) and (max-width: 900px) {
      #rotateMsg { display: block; }
      #wrapper, #menu, #options, #controls, #gameover, #spruch {
        display: none !important;
      }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, -60%); }
      to   { opacity: 1; transform: translate(-50%, -50%); }
    }
  </style>
</head>
<body>
  <div id="menu">
    <h1>üßü ENDLESS JUMP</h1>
    <button onclick="prepareGame()">‚ñ∂ SPIEL STARTEN</button><br>
    <button onclick="showControls()">üïπÔ∏è STEUERUNG</button><br>
    <button onclick="showOptions()">‚öôÔ∏è OPTIONEN</button>
  </div>
  <div id="controls"><h2>üïπÔ∏è STEUERUNG</h2><p>SPACE / TAP</p><button onclick="backToMenu()">üîô ZUR√úCK</button></div>
  <div id="options">
    <h2 id="optionsTitle">‚öôÔ∏è OPTIONEN</h2>
    <label id="volumeLabel">Lautst√§rke: <input type="range" min="0" max="1" step="0.01" value="0.5" id="volumeSlider"></label><br><br>
    <button onclick="resetHighscore()">‚õî HIGHSCORE L√ñSCHEN</button><br><br>
    <button id="devToggle" style="display:none" onclick="tV()">DEV MODE: OFF</button><br><br>
    <button onclick="backToMenu()">üîô ZUR√úCK</button>
  </div>
  <div id="gameover">
    <h1>üíÄ GAME OVER</h1>
    <p id="scoreDisplay" style="margin-top: 60px;"></p>
    <button onclick="prepareGame()">üîÅ NOCHMAL</button>
    <button onclick="showOptions()">‚öôÔ∏è OPTIONEN</button>
    <button onclick="backToMenu()">üö™ AUFGEBEN</button>
  </div>
  <div id="spruch"></div>
  <div id="wrapper"><canvas id="game" width="1024" height="576" tabindex="0"></canvas></div>
  <div id="rotateMsg">üîÑ Bitte Ger√§t drehen</div>
  <audio id="bgmusic" src="bgmusic.mp3" loop></audio>
  <audio id="darkmusic" src="darktheme.mp3" loop></audio>
  <audio id="gameovermusic" src="gameover.mp3" loop></audio>
  <script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const player = { x: 100, y: 0, width: 32, height: 32, velY: 0, onGround: false };
const gravity = 0.6, jumpForce = -16;
let scrollX = 0, speed = 3, speedTimer = 0, score = 0;
let platforms = [], gameReady = false, isGameRunning = false;
const maxJumpHeight = Math.pow(Math.abs(jumpForce), 2) / (2 * gravity);
let darkMusicStarted = false;
let highscore = parseInt(localStorage.getItem("highscore") || "0");
let wasInGameOverScreen = false;
let devUnlocked = false;
let devMode = false;
let deathDots = [];

function fitScreen() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}

function goFullscreen() {
  const el = document.documentElement;
  const req = el.requestFullscreen || el.webkitRequestFullscreen || el.mozRequestFullScreen || el.msRequestFullscreen;
  if (req) {
    req.call(el).catch(() => {});
  }
  canvas.focus();
}

window.addEventListener("resize", fitScreen);
window.addEventListener("orientationchange", () => { fitScreen(); checkOrientation(); });
document.addEventListener("fullscreenchange", fitScreen);
fitScreen();

const music = document.getElementById("bgmusic");
const darkMusic = document.getElementById("darkmusic");
const gameoverMusic = document.getElementById("gameovermusic");
let resumeAudios = [];
const sayings = [
  "üåà Beim n√§chsten Mal klappt‚Äôs bestimmt!",
  "üí™ Aufstehen, Krone richten, weiterh√ºpfen!",
  "üéÆ Das war nur der Probelauf.",
  "üåü Du bist der Held unserer Herzen!",
  "‚òï Eine Pause und dann: Comeback!"
];

const menu = document.getElementById("menu");
const options = document.getElementById("options");
const controls = document.getElementById("controls");
const gameover = document.getElementById("gameover");
const spruchBox = document.getElementById("spruch");
const scoreDisplay = document.getElementById("scoreDisplay");
const devToggleBtn = document.getElementById("devToggle");
const optionsTitle = document.getElementById("optionsTitle");

if (devUnlocked) {
  devToggleBtn.style.display = "inline-block";
  devToggleBtn.textContent = `DEV MODE: ${devMode ? "ON" : "OFF"}`;
}

let secretClicks = [];
function handleSecret() {
  const now = Date.now();
  secretClicks = secretClicks.filter(t => now - t < 600);
  secretClicks.push(now);
  if (secretClicks.length >= 5) {
    secretClicks = [];
    sV();
  }
}

optionsTitle.addEventListener("click", handleSecret);
optionsTitle.addEventListener("touchstart", handleSecret);

document.getElementById("volumeSlider").addEventListener("input", e => {
  const vol = parseFloat(e.target.value);
  [music, darkMusic, gameoverMusic].forEach(a => a.volume = vol);
});

function pauseAllAudio() {
  [music, darkMusic, gameoverMusic].forEach(a => {
    if (!a.paused) {
      a.pause();
      resumeAudios.push(a);
    }
  });
}

function resumePausedAudio() {
  resumeAudios.forEach(a => a.play().catch(() => {}));
  resumeAudios = [];
}

function handleVisibilityChange() {
  if (document.hidden) {
    pauseAllAudio();
  } else {
    resumePausedAudio();
  }
}

document.addEventListener("visibilitychange", handleVisibilityChange);
window.addEventListener("pagehide", pauseAllAudio);
window.addEventListener("pageshow", resumePausedAudio);

function resetHighscore() {
  highscore = 0;
  localStorage.setItem("highscore", "0");
}

const p0 = [68,103,121,78,110,70,43,107,98,109,97,57,103,112,77,111,110,107,69,76,118,74,52,49,50,104,67,105,69,97,84,86,119,43,67,50,83,106,99,57,116,85,56,61];
const p1 = String.fromCharCode(...p0);
let devModal;

async function xv(pw) {
  const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(pw));
  const arr = Array.from(new Uint8Array(buf));
  const b64 = btoa(String.fromCharCode(...arr));
  return b64 === p1;
}

function sV() {
  if (!devModal) {
    devModal = document.createElement("div");
    devModal.style.position = "absolute";
    devModal.style.top = "50%";
    devModal.style.left = "50%";
    devModal.style.transform = "translate(-50%,-50%)";
    devModal.style.background = "rgba(10,10,10,0.95)";
    devModal.style.padding = "20px";
    devModal.style.border = "4px double #00ffcc";
    devModal.style.color = "#00ffcc";
    devModal.style.zIndex = 30;
    devModal.style.textAlign = "center";
    devModal.innerHTML = '<h2>Dev Mode Enable</h2><input id="devPass" type="password" style="font-size:16px;"><br><br><button id="devOk">OK</button>';
    document.body.appendChild(devModal);
    devModal.querySelector("#devOk").addEventListener("click", cV);
  }
  devModal.style.display = "block";
  devModal.querySelector("#devPass").value = "";
  devModal.querySelector("#devPass").focus();
}

async function cV() {
  const val = devModal.querySelector("#devPass").value;
  if (await xv(val)) {
    devUnlocked = true;
    devModal.style.display = "none";
    devToggleBtn.style.display = "inline-block";
    devToggleBtn.textContent = `DEV MODE: ${devMode ? "ON" : "OFF"}`;
  } else {
    devModal.style.display = "none";
  }
}

function tV() {
  devMode = !devMode;
  devToggleBtn.textContent = `DEV MODE: ${devMode ? "ON" : "OFF"}`;
}

function easeInOutQuad(x) {
  return x < 0.5 ? 2 * x * x : 1 - Math.pow(-2 * x + 2, 2) / 2;
}

function lerp(a, b, t) { return a + (b - a) * t; }

function lerpColor(c1, c2, t) {
  const r = Math.round(lerp(c1[0], c2[0], t));
  const g = Math.round(lerp(c1[1], c2[1], t));
  const b = Math.round(lerp(c1[2], c2[2], t));
  return `rgb(${r},${g},${b})`;
}

function blend3(c1, c2, c3, t) {
  return t < 0.5
    ? lerpColor(c1, c2, t * 2)
    : lerpColor(c2, c3, (t - 0.5) * 2);
}

function lighten(color, t) {
  return [
    lerp(color[0], 255, t),
    lerp(color[1], 255, t),
    lerp(color[2], 255, t)
  ];
}

function showMenu() {
  [menu].forEach(el => el.style.display = "block");
  [options, controls, gameover, spruchBox].forEach(el => el.style.display = "none");
  isGameRunning = false;
  if (devModal) devModal.style.display = "none";
}

function backToMenu() {
  [options, controls, gameover, spruchBox].forEach(el => el.style.display = "none");
  menu.style.display = "block";
  if (devModal) devModal.style.display = "none";
}

function showOptions() {
  [menu, controls, gameover].forEach(el => el.style.display = "none");
  options.style.display = "block";
  if (devUnlocked) {
    devToggleBtn.style.display = "inline-block";
    devToggleBtn.textContent = `DEV MODE: ${devMode ? "ON" : "OFF"}`;
  }
}

function showControls() {
  [menu, options, gameover].forEach(el => el.style.display = "none");
  controls.style.display = "block";
}

function maxJumpDistance(currentSpeed) {
  const maxJumpTime = (Math.abs(jumpForce) * 2) / gravity;
  return currentSpeed * maxJumpTime;
}

function createPlatform() {
  const baseY = canvas.height - 80;
  const last = platforms[platforms.length - 1];
  const maxGap = Math.max(100, maxJumpDistance(speed) * 0.9);
  const minGap = maxGap * 0.4;
  const gap = Math.random() * (maxGap - minGap) + minGap;
  const maxHeightChange = Math.min(150, maxJumpHeight - 20);
  let y = last.y + Math.random() * maxHeightChange * 2 - maxHeightChange;
  y = Math.max(270, Math.min(baseY, y));
  const width = Math.random() * 60 + 80;
  const x = last.x + last.width + gap;
  platforms.push({ x, y, width, height: 16 });
}

function respawnPlayer() {
  let next = platforms.find(p => p.x >= player.x) || platforms[platforms.length - 1];
  player.x = next.x + next.width / 2 - player.width / 2;
  player.y = next.y - player.height;
  player.velY = 0;
  player.onGround = true;
  scrollX = player.x - canvas.width * 0.3;
}

function prepareGame() {
  goFullscreen();
  fitScreen();
  [gameoverMusic, darkMusic, music].forEach(a => { a.pause(); a.currentTime = 0; });
  darkMusicStarted = false;
  wasInGameOverScreen = false;
  [menu, options, controls, gameover, spruchBox].forEach(el => el.style.display = "none");
  scrollX = 0; speed = 3; speedTimer = 0; platforms = []; score = 0;
  const baseY = canvas.height - 80;
  const clampY = y => Math.max(270, Math.min(baseY, y));

  let x = 0, y = baseY;
  platforms.push({ x, y, width: 120, height: 16 });

  x += 160;
  y = clampY(y + (Math.random() * 60 - 30));
  platforms.push({ x, y, width: 110, height: 16 });

  x += 180;
  y = clampY(y + (Math.random() * 80 - 40));
  platforms.push({ x, y, width: 110, height: 16 });

  x += 200;
  y = clampY(y + (Math.random() * 80 - 40));
  platforms.push({ x, y, width: 100, height: 16 });

  for (let i = platforms.length; i < 15; i++) {
    createPlatform();
  }

  const firstPlatform = platforms[0];
  player.x = firstPlatform.x + firstPlatform.width / 2 - player.width / 2;
  player.y = firstPlatform.y - player.height;

  scrollX = player.x - canvas.width * 0.3;
  player.velY = 0;
  player.onGround = true;
  gameReady = true;
  isGameRunning = false;
  draw();
  lastTime = performance.now();
  requestAnimationFrame(gameLoop);
}

function startGame(withJump = false) {
  goFullscreen();
  fitScreen();
  isGameRunning = true;
  music.volume = 0.5;
  [music, darkMusic].forEach(a => { a.pause(); a.currentTime = 0; });
  music.play().catch(() => {});
  if (withJump && player.onGround) {
    player.velY = jumpForce;
    player.onGround = false;
  }
}

document.addEventListener("keydown", e => {
  if (e.code === "Space") {
    if (!isGameRunning && (wasInGameOverScreen || gameover.style.display === "block")) {
      wasInGameOverScreen = false;
      prepareGame();
      return;
    }
    if (gameReady) {
      startGame(true);
      gameReady = false;
    } else if (player.onGround) {
      player.velY = jumpForce;
      player.onGround = false;
    }
  }
});

canvas.addEventListener("touchstart", e => {
  e.preventDefault();
  if (gameReady) {
    startGame(true);
    gameReady = false;
  } else if (player.onGround) {
    player.velY = jumpForce;
    player.onGround = false;
  }
}, { passive: false });

function checkOrientation() {
  if (window.matchMedia("(orientation: portrait)").matches) {
    isGameRunning = false;
    pauseAllAudio();
  } else if (!document.hidden) {
    resumePausedAudio();
  }
}
checkOrientation();

let lastTime = 0;
function gameLoop(timestamp) {
  const delta = (timestamp - lastTime) / 16.6667;
  lastTime = timestamp;
  update(delta);
  draw();
  requestAnimationFrame(gameLoop);
}

function update(delta) {
  if (!isGameRunning) return;
  speedTimer += delta;
  score = Math.floor(speedTimer / 10);

  if (score >= 300 && !darkMusicStarted) {
    darkMusicStarted = true;
    darkMusic.volume = 0;
    darkMusic.play().catch(() => {});
  }

  if (darkMusicStarted) {
    music.volume = Math.max(0, music.volume - 0.0007 * delta);
    if (score < 600) {
      darkMusic.volume = Math.min(0.5, darkMusic.volume + 0.0007 * delta);
    } else {
      darkMusic.volume = Math.max(0, darkMusic.volume - 0.0007 * delta);
      if (darkMusic.volume === 0) darkMusic.pause();
    }
  }

  if (Math.floor(speedTimer / 600) > Math.floor((speedTimer - delta) / 600) && speed < 6) {
    speed += 0.25;
  }

  player.velY += gravity * delta;
  player.y += player.velY * delta;
  if (player.y < 20 && player.velY < 0) player.velY *= 0.5;
  player.x += speed * delta;
  scrollX = player.x - canvas.width * 0.3;

  if (platforms[0].x + platforms[0].width < scrollX - 100) {
    platforms.shift();
    createPlatform();
  }

  player.onGround = false;
  for (let p of platforms) {
    if (player.x < p.x + p.width && player.x + player.width > p.x &&
        player.y + player.height < p.y + 10 &&
        player.y + player.height + player.velY * delta >= p.y) {
      player.y = p.y - player.height;
      player.velY = 0;
      player.onGround = true;
    }
  }

  if (player.y > canvas.height) {
    if (devMode) {
      deathDots.push({ x: player.x, y: canvas.height - 10, life: 120 });
      respawnPlayer();
    } else {
      isGameRunning = false;
      wasInGameOverScreen = true;
      if (score > highscore) {
        highscore = score;
        localStorage.setItem("highscore", highscore);
      }
      scoreDisplay.innerHTML = `Dein Score: ${score}<br><br>Highscore: ${highscore}`;
      spruchBox.textContent = sayings[Math.floor(Math.random() * sayings.length)];
      spruchBox.style.display = "block";
      gameover.style.display = "block";
      [music, darkMusic].forEach(a => { a.pause(); a.currentTime = 0; });
      gameoverMusic.play().catch(() => {});
    }
  }
}

function draw() {
  const corruption = Math.min(1, score / 500);
  const smooth = easeInOutQuad(corruption);
  const skyTop = lerpColor([50, 60, 70], [20, 20, 20], smooth);
  const skyBottom = lerpColor([80, 90, 100], [10, 10, 10], smooth);
  const sky = ctx.createLinearGradient(0, 0, 0, canvas.height);
  sky.addColorStop(0, skyTop);
  sky.addColorStop(1, skyBottom);
  ctx.fillStyle = sky;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  for (let p of platforms) {
    const r = lerp(80, 40, smooth);
    const g = lerp(80, 40, smooth);
    const b = lerp(80, 40, smooth);
    const base = [r, g, b];
    const highlight = lighten(base, 0.2);
    const grad = ctx.createLinearGradient(0, p.y, 0, p.y + 8);
    grad.addColorStop(0, `rgb(${Math.round(highlight[0])},${Math.round(highlight[1])},${Math.round(highlight[2])})`);
    grad.addColorStop(1, `rgb(${Math.round(r)},${Math.round(g)},${Math.round(b)})`);
    ctx.fillStyle = grad;
    ctx.fillRect(p.x - scrollX, p.y, p.width, 8);
    ctx.fillStyle = `rgba(0,0,0,0.6)`;
    ctx.fillRect(p.x - scrollX, p.y + 8, p.width, 8);
  }

  const px = player.x - scrollX, py = player.y;
  const base1 = [26, 200, 180];
  const base2 = [15, 80, 70];
  const c1 = lerpColor(base1, [80,80,80], smooth);
  const c2 = lerpColor(base2, [30,30,30], smooth);
  const grad = ctx.createRadialGradient(px + 16, py + 16, 4, px + 16, py + 16, 16);
  grad.addColorStop(0, c1);
  grad.addColorStop(1, c2);
  ctx.fillStyle = grad;
  ctx.beginPath();
  ctx.arc(px + 16, py + 16, 16, 0, Math.PI * 2);
  ctx.fill();

  ctx.fillStyle = "#fff";
  ctx.beginPath();
  ctx.arc(px + 10, py + 12, 2, 0, Math.PI * 2);
  ctx.fill();
  ctx.beginPath();
  ctx.arc(px + 22, py + 12, 2, 0, Math.PI * 2);
  ctx.fill();

  deathDots = deathDots.filter(d => d.life-- > 0);
  ctx.fillStyle = "red";
  for (let d of deathDots) {
    ctx.beginPath();
    ctx.arc(d.x - scrollX, d.y, 4, 0, Math.PI * 2);
    ctx.fill();
  }

  // Score oben rechts, leicht nach unten versetzt
  const scoreX = canvas.width - 10;
  const scoreY = 50;
  ctx.font = "16px 'Inter'";
  ctx.textAlign = "right";
  ctx.textBaseline = "top";
  ctx.fillStyle = "black";
  ctx.fillText("Score: " + score, scoreX + 1, scoreY + 1);
  ctx.fillStyle = "#1abc9c";
  ctx.fillText("Score: " + score, scoreX, scoreY);
}

showMenu();
  </script>
</body>
</html>
